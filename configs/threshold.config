# Suricata Threshold Configuration
#
# This file controls rate limiting, event filtering, and alert suppression.
# Use these features to reduce alert fatigue and focus on meaningful events.
#
# Three main types of configurations:
#   1. threshold - Alert only after N events in T seconds
#   2. limit - Alert once per T seconds after N events
#   3. suppress - Completely suppress alerts based on criteria
#
# Tracking options:
#   - by_src: Track by source IP address
#   - by_dst: Track by destination IP address
#   - by_both: Track by source AND destination IP pair
#   - by_rule: Track globally for the rule
#
# Format examples:
#   threshold gen_id <gid>, sig_id <sid>, type <threshold|limit|both>, track <by_src|by_dst|by_both|by_rule>, count <N>, seconds <T>
#   suppress gen_id <gid>, sig_id <sid>
#   suppress gen_id <gid>, sig_id <sid>, track <by_src|by_dst|by_both>, ip <address|CIDR>

# ==============================================================================
# THRESHOLD EXAMPLES - Alert after N events in T seconds
# ==============================================================================

# Example 1: Alert only after 10 occurrences within 60 seconds
# Useful for noisy rules that generate many false positives
# threshold gen_id 1, sig_id 2100498, type threshold, track by_src, count 10, seconds 60

# Example 2: Alert after 5 SSH connection attempts from same source in 120 seconds
# Helps detect SSH brute force attacks
# threshold gen_id 1, sig_id 2001219, type threshold, track by_src, count 5, seconds 120

# Example 3: Alert after 20 DNS queries from same source in 30 seconds
# Detects potential DNS tunneling or data exfiltration
# threshold gen_id 1, sig_id 2100001, type threshold, track by_src, count 20, seconds 30

# Example 4: Web application scan detection - 50 requests in 10 seconds
# Identifies automated scanning tools
# threshold gen_id 1, sig_id 2200050, type threshold, track by_src, count 50, seconds 10

# ==============================================================================
# LIMIT EXAMPLES - Alert once per T seconds after N events
# ==============================================================================

# Example 1: After 5 events, alert only once every 300 seconds (5 minutes)
# Reduces duplicate alerts for ongoing attacks
# limit gen_id 1, sig_id 2210001, type limit, track by_src, count 5, seconds 300

# Example 2: Port scan detection - alert once per hour per source
# limit gen_id 1, sig_id 2000333, type limit, track by_src, count 1, seconds 3600

# Example 3: Malware C2 beacon - alert once every 30 minutes
# Reduces noise from repetitive beacon traffic
# limit gen_id 1, sig_id 2404000, type limit, track by_both, count 1, seconds 1800

# Example 4: ICMP flood - alert once per source every 60 seconds
# limit gen_id 1, sig_id 2100366, type limit, track by_src, count 10, seconds 60

# ==============================================================================
# BOTH TYPE - Combines threshold and limit behavior
# ==============================================================================

# Example: Alert on 5th event, then once every 60 seconds
# both type first applies threshold, then applies limit
# threshold gen_id 1, sig_id 2100500, type both, track by_src, count 5, seconds 60

# ==============================================================================
# SUPPRESS EXAMPLES - Completely disable alerts
# ==============================================================================

# Example 1: Suppress a specific rule completely
# Use when a rule is not applicable to your environment
# suppress gen_id 1, sig_id 2100498

# Example 2: Suppress alerts for a specific source IP
# Useful for trusted internal scanners or monitoring systems
# suppress gen_id 1, sig_id 2100498, track by_src, ip 192.168.1.100

# Example 3: Suppress alerts for an entire subnet
# suppress gen_id 1, sig_id 2210001, track by_src, ip 10.0.0.0/8

# Example 4: Suppress alerts going to a specific destination
# Useful for honeypots or known test systems
# suppress gen_id 1, sig_id 2001219, track by_dst, ip 192.168.100.50

# Example 5: Suppress alerts for specific IP pair
# suppress gen_id 1, sig_id 2404000, track by_both, ip 192.168.1.10, ip 192.168.1.20

# ==============================================================================
# PRACTICAL USE CASES
# ==============================================================================

# Use Case 1: Reducing noise from vulnerability scanners
# If you run Nessus, OpenVAS, or similar from 192.168.1.50
# suppress gen_id 1, sig_id 2100498, track by_src, ip 192.168.1.50
# suppress gen_id 1, sig_id 2100499, track by_src, ip 192.168.1.50

# Use Case 2: SSH brute force from single source
# Alert only after 10 failed attempts in 5 minutes
# threshold gen_id 1, sig_id 2001219, type threshold, track by_src, count 10, seconds 300

# Use Case 3: Rate limit port scan alerts
# Alert once per scanning host every 10 minutes
# limit gen_id 1, sig_id 2000333, type limit, track by_src, count 1, seconds 600

# Use Case 4: Web application attacks
# Alert after 20 attempts, then once every hour
# threshold gen_id 1, sig_id 2200001, type both, track by_src, count 20, seconds 3600

# Use Case 5: Suppress known false positives to specific internal servers
# suppress gen_id 1, sig_id 2210005, track by_dst, ip 192.168.10.100

# Use Case 6: ICMP monitoring - reduce flood alerts
# threshold gen_id 1, sig_id 2100366, type threshold, track by_src, count 100, seconds 10

# Use Case 7: DNS query monitoring from DNS servers
# Suppress DNS alerts from legitimate DNS servers
# suppress gen_id 1, sig_id 2100001, track by_src, ip 192.168.1.2
# suppress gen_id 1, sig_id 2100001, track by_src, ip 192.168.1.3

# Use Case 8: File download alerts - limit repetitive downloads
# Alert once per source/destination pair every 5 minutes
# limit gen_id 1, sig_id 2100002, type limit, track by_both, count 1, seconds 300

# Use Case 9: Malware C2 callbacks - alert on persistence
# Alert after 3 callbacks within 1 hour, then hourly
# threshold gen_id 1, sig_id 2404000, type both, track by_src, count 3, seconds 3600

# Use Case 10: SSL/TLS certificate issues
# Suppress certificate warnings for internal self-signed certs
# suppress gen_id 1, sig_id 2230000, track by_dst, ip 192.168.50.0/24

# ==============================================================================
# COMMON PATTERNS FOR DIFFERENT ATTACK TYPES
# ==============================================================================

# Brute Force Attacks (SSH, FTP, HTTP Auth)
# ==========================================
# Alert after 10 attempts in 5 minutes
# threshold gen_id 1, sig_id <brute_force_sid>, type threshold, track by_src, count 10, seconds 300

# Port Scanning
# =============
# Alert once per scanner per 15 minutes
# limit gen_id 1, sig_id <port_scan_sid>, type limit, track by_src, count 1, seconds 900

# DoS/DDoS Attacks
# ================
# Alert after 100 packets in 10 seconds, then once per minute
# threshold gen_id 1, sig_id <dos_sid>, type both, track by_src, count 100, seconds 60

# Web Application Scans
# =====================
# Alert after 30 attempts in 60 seconds
# threshold gen_id 1, sig_id <web_scan_sid>, type threshold, track by_src, count 30, seconds 60

# Data Exfiltration (DNS Tunneling, ICMP Tunneling)
# ==================================================
# Alert after sustained activity: 50 events in 120 seconds
# threshold gen_id 1, sig_id <exfil_sid>, type threshold, track by_src, count 50, seconds 120

# Malware Beacons
# ===============
# Alert on first detection, then once per hour
# limit gen_id 1, sig_id <beacon_sid>, type limit, track by_both, count 1, seconds 3600

# ==============================================================================
# TIPS FOR EFFECTIVE THRESHOLD CONFIGURATION
# ==============================================================================
#
# 1. Start with logging everything, then add thresholds as needed
# 2. Use 'by_src' for attacks originating from external sources
# 3. Use 'by_dst' for attacks targeting specific internal systems
# 4. Use 'by_both' for session-based attacks or when direction matters
# 5. Use 'by_rule' sparingly - it affects all traffic globally
# 6. Monitor your alert volume and adjust thresholds accordingly
# 7. Document why you're suppressing or limiting specific rules
# 8. Regularly review suppressed rules - threats evolve
# 9. Test threshold changes in a non-production environment first
# 10. Keep your trusted IP suppressions up to date
#
# ==============================================================================
# MONITORING RECOMMENDATIONS
# ==============================================================================
#
# - Review your stats.log regularly to identify noisy rules
# - Check eve.json for patterns in alert frequency
# - Use 'suricata -T' to test configuration before applying
# - Keep a changelog of threshold modifications
# - Set up alerts for when suppression lists grow too large
#
# ==============================================================================
# END OF THRESHOLD CONFIGURATION
# ==============================================================================
